[toc]

## Куб мастштабирования системы

![Microservices fig 1](/Users/web/Google Drive/MD/Microsirvices/Microservices fig 1.png)

В данной модели, масштабирование приложения с помощью запуска клона за балансером нагрузки представленно осью X. Паттерн микросейвисной архитектуры это масштабирование по оси Y.

### Масштабирование по Оси Х

Данное масштабирование происходит путем запуска множества копий находящихся за балансером нагрузки.Если существует N копий , где каждая копия обрабатывает 1/N % нагрузки.

Одним из недостатков является потенциальная возможность копии иметь доступ ко всем данным, а кэши требуют много памяти. Другая проблема в том что при увеличении темпов разработки возрастает и сложность самого приложения.

### Масштабирование по Оси Y

В отличии от Осей X и Z которые предполагают запуск множества идентичных копий приложения, Ось Y - это масштабирование путем разделения на множество различных сервисов. Каждый сервис отвечает за одну или более взаимосвязанных функций. Существует несколько различных путей для декомпозиции приложения на микросервисы.
**Первым подходом является разделение по глаголам (splitting by verb):**
Идея думать о сервисе как о наборе действий (глаголов).
Например оформление заказа, аутентификация и т.п.
**Следующим подходом является разделение по существительным (splitting by noun):**
Идея разделить сервим по существующим существительным, например аккаунты, пользователи, сервис и т.п.

Комбинированный подход, подразумевает разделение по глаголам или существительным по необходимости, но не в рамках одного сервиса. Те может существовать сервис аккаунтов и сервис заказов основанных на существительних, а для их взаимодействия использоваться сервис транзакций основанный на глаголах.

### Масштабирование по Оси Z

Масштабирование по Оси Z в целом мохоже на мастшабирование по Оси X с тем различием, что клоны приложения обрабатывают **разные** запросы. Чаще всего такое масштабирование встречается при работе с БД, когда разные копии одной и той же БД могут быть доступны только для чтения либо только для записи. В этом отношении на кэш системы возлагается меньшая и специфичная для конкретного инстанса нагрузка.

**На основе статей**:
[Microservices:Architecture](https://medium.com/@cinish/microservices-architecture-5da90504f92a)
[The Scale Cube](https://microservices.io/articles/scalecube.html)

## Patterns

### Microservice Architecture

**Контекст**:

Вы разрабатываете серверное приложение. Оно должно поддерживать работу с различными видами клиентов такими как браузеры, мобилные устройства и мобильные приложения. Приложение должно предоставить  API для 3-й стороны. Оно так же может быть интегрированно с другими приложениями через веб сервисы или брокеры сообщений. Приложение обрабатывает запросы (HTTP запросы и сообщения) исполняя бизнес логику, давая доступ к БД, обмениваясь сообщениями с другими системами и возвращая ответ в виде  HTML/JSON/XML. Существует логические компоненты соответствующие различным функциональностям приложения.

**Проблема**:
Какая арзитектура нужна ?

**Условия и потребности:**

- Есть команда разработчиков, работающих с приложением.
- Новые члены команды должны быстро выходить в "боевой режим"
- Данное приложение должно быть легко в понимании и модификации.
- Вы должны запускать множество копий приложение на множестве компьютеров в порядке удволетворения потребностией в масштабировании и доступности.
- Вы хотите получить преимущества от используемых технологий

**Решение**:
Определим архитектуру как набор слабосвязанных, кооперативно работающих сервисов. Данное решение соотетствует [оси масштабирования  Y](#Масштабирование по Оси Y). В этом случае каждый сервис:

- Легко поддерживаемый и тестируемый - возможны быстрые и частые итерации в разработки, ввиду ограниченной функциональности.
- Малосвязанный с другими сервисами - возможна разработка без необходимости тратить время на встраивание изменений в другие сервисы и не боясь потенциала затронуть функционал и работоспособность других сервисов.
- Независимый деплой - доставка кода производится в конкретный сервис , а не весь проект, что позволяет деплоить без координирования с другими командами.
- Возможность разработки меньшей командой -  ограниченная функциональность позволяет отвечающей за сервис команде мыть пробуктивными избегая коммуникации и высоской вовлеченности в переговоры с главами других команд.

Сервисы общаются используя синхронные/асинхронные протоколы, такие как  HTTP/REST/AMQP и т.п. Сервисы могут разрабатываться независимо друг от друга. Каждый сервис имеет своб БД, независящую и не использующуюся другими сервисами. Консистентность между сервисами осуществляется с использованием 

**Примеры**:

### Saga Pattern

**Контекст**:


### Comand Query Responsibility Segregation (CQRS) Pattern

**Контекст**:
Вы применили паттерны [Microservice Architecture](#Microservice Architecture)

### Database per service Pattern

**Контекст**:
